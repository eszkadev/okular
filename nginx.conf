events {
    worker_connections 1024;
}

http {
    upstream okular-job1 {
        server okular-job1:8000;
    }

    upstream okular-job2 {
        server okular-job2:8000;
    }

    server {
        listen 80;

        # Route based on job identifier in URL path
        # Example: /job1/ -> okular-job1 instance
        #          /job2/ -> okular-job2 instance

        location /job1/ {
            rewrite ^/job1(/.*)$ $1 break;
            proxy_pass http://okular-job1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        location /job2/ {
            rewrite ^/job2(/.*)$ $1 break;
            proxy_pass http://okular-job2;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Add more locations as needed:
        # location /job3/ {
        #     rewrite ^/job3(/.*)$ $1 break;
        #     proxy_pass http://okular-job3;
        #     proxy_set_header Host $host;
        #     proxy_set_header X-Real-IP $remote_addr;
        #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        #     proxy_set_header X-Forwarded-Proto $scheme;
        # }

        # Default route - returns list of available job endpoints
        location / {
            default_type text/html;
            return 200 '<html><body><h1>Okular Gateway</h1><ul><li><a href="/job1/">job1</a></li><li><a href="/job2/">job2</a></li></ul></body></html>';
        }
    }
}
